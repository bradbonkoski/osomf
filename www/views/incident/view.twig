{% extends "layout.twig" %}
{% block css %}
        <link rel="stylesheet" href="/osomf/www/css/jquery.ui.all.css">
{% endblock %}
{% block content %}
        <input type="hidden" id="incidentId" value="{{ incidentId }}"/>
    <!--
    <a href="/osomf/incident/edit/{{ incidentId }}">edit</a>
    -->
    <input class="btnEdit" id="btnEdit" type="button" value="Edit"/>
    <input class="btnAudit" id="btnAudit" type="button" value="History" />
        <fieldset>
            <legend>incident information</legend>

            <dl>
                <dt><label>title</label></dt>
                <dd>{{ incidentTitle }}</dd>
            </dl>

            <dl>
                <dt><label>status</label></dt>
                <dd>
                    <span id="incidentStatus">{{ status }}</span>
                    <a id="changeIncidentStatus" href="#">
                        <img src="/osomf/www/img/arrow_switch.png"/>
                    </a>
                </dd>
            </dl>

            <dl>
                <dt><label>severity</label></dt>
                <dd>{{ severity }}</dd>
            </dl>

            <dl>
                <dt><label>Description</label></dt>
                <dd>{{ desc }}</dd>
            </dl>

            <dl>
                <dt><label>Impact</label></dt>
                <dd>{{ impact }}</dd>
            </dl>

            <dl>
                <dt><label>Revenue Impact</label></dt>
                <dd>{{ revImpact }}</dd>
            </dl>
        </fieldset>

    <fieldset class="container">
    <div class="colLeft">
        <fieldset>
            <legend>timeline</legend>
            <dl>
                <dt><label>Detect Time</label></dt>
                <dd>{{ detectTime }}</dd>
            </dl>
            <dl>
                <dt><label>start time</label></dt>
                <dd>{{ startTime }}</dd>
            </dl>
            <dl>
                <dt><label>create time</label></dt>
                <dd>{{ ctime }}</dd>
            </dl>
            <dl>
                <dt><label>last modified</label></dt>
                <dd>{{ mtime }}</dd>
            </dl>
        </fieldset>
    </div>
    <div class="colRight">
        <fieldset>
            <legend>Resolution</legend>
            <dl>
                <dt><label>Resolve Time</label></dt>
                <dd>{{ resolveTime }}</dd>
            </dl>
            <dl>
                <dt><label>Resolve Steps</label></dt>
                <dd>{{ resolveSteps }}</dd>
            </dl>
            <dl>
                <dt><label>Responsible Project</label></dt>
                <dd><a href="{{ respProjLink }}">{{ respProjName }}</a></dd>
            </dl>
        </fieldset>
    </div>
    </fieldset>

    <fieldset>
        <legend>impacts <a id="impactAddModal" href="#"><img src="/osomf/www/img/add.png"/></a></legend>
        <table class="baseTable" id="incidentImpactsTable">
            <tr>
                <th>type</th>
                <th>impact</th>
                <th>severity</th>
                <th>description</th>
                <th></th>
            </tr>
            {% for im in impacts %}
            <tr id="impactRow{{ im.id }}">
                <td>{{ im.type }}</td>
                <td><a href="/osomf/{{ im.type }}/view/{{ im.itemId }}">{{ im.item }}</a></td>
                <td>{{ im.sev }}</td>
                <td>{{ im.desc }}</td>
                <td><img src="/osomf/www/img/cancel.png" onclick="javascript:removeImpact('{{ im.id }}')"/> </td>
            </tr>
            {% endfor %}
        </table>
    </fieldset>

    <fieldset>
        <legend>Worklog <a id="worklogAddModal" href="#"><img src="/osomf/www/img/add.png"/></a></legend>
        <table class="baseTable" id="incidentWorklogTable">
            <tr>
                <th>user</th>
                <th>time</th>
                <th>type</th>
                <th>data</th>
            </tr>
            {% for wl in worklogs %}
            <tr>
                <td>{{ wl.user }}</td>
                <td>{{ wl.mtime }}</td>
                <td>{{ wl.type }}</td>
                {% if wl.type == 'STATUS' %}
                    <td>[orig] {{ wl.data[0] }} [new] {{ wl.data[1] }} [Reason] {{ wl.data[2] }}</td>
                {% else %}
                <td>{{ wl.data }}</td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
    </fieldset>

     {% include 'modals/incidentImpact.twig' %}
     {% include 'modals/incidentWorklog.twig' %}
     {% include 'modals/incidentStatusUpdate.twig' %}
{% endblock %}


    
{% block js %}
    <script type="text/javascript" src="/osomf/www/js/jquery.ui.core.min.js"></script>
    <script type="text/javascript" src="/osomf/www/js/jquery.ui.widget.min.js"></script>
    <script type="text/javascript" src="/osomf/www/js/jquery.ui.position.min.js"></script>
    <script type="text/javascript" src="/osomf/www/js/jquery.ui.autocomplete.min.js"></script>
    <script type="text/javascript" src="/osomf/www/js/jquery.simplemodal.1.4.1.min.js"></script>
    <script type="text/javascript" src="/osomf/www/js/incident.js"></script>
{% endblock %}

